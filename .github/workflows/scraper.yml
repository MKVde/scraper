- name: ðŸ“¡ Send HTML data to PHP API
  if: success()
  env:
    PHP_API_URL: ${{ secrets.PHP_API_URL }}
    PHP_API_KEY: ${{ secrets.PHP_API_KEY }}
  run: |
    if [ -z "$PHP_API_URL" ] || [ -z "$PHP_API_KEY" ]; then
      echo "âš ï¸ API credentials not set"
      exit 0
    fi
    
    # Find latest COMBINED file (has both HTML + API data)
    LATEST_COMBINED=$(ls -t data/searates_[0-9]*_[0-9]*.json 2>/dev/null | grep -v 'api_' | head -1)
    
    if [ -n "$LATEST_COMBINED" ]; then
      echo "ðŸ“¤ Sending combined data: $(basename $LATEST_COMBINED)"
      
      RESPONSE=$(curl -s -w "\n%{http_code}" -X POST "$PHP_API_URL" \
        -H "X-API-KEY: $PHP_API_KEY" \
        -H "Content-Type: application/json" \
        -d @"$LATEST_COMBINED")
      
      HTTP_CODE=$(echo "$RESPONSE" | tail -1)
      BODY=$(echo "$RESPONSE" | head -n -1)
      
      echo "Response: $BODY"
      echo "HTTP Code: $HTTP_CODE"
      
      if [ "$HTTP_CODE" = "200" ]; then
        echo "âœ… Success!"
      else
        echo "âš ï¸ Failed with status $HTTP_CODE"
      fi
    else
      echo "âš ï¸ No combined file found"
    fi
    
    # Show what was saved
    echo ""
    echo "ðŸ“ Files saved in this run:"
    echo ""
    echo "API responses (40KB JSON):"
    ls -lh data/searates_api_*.json 2>/dev/null | tail -3 || echo "  (none)"
    echo ""
    echo "Combined data (API + HTML):"
    ls -lh data/searates_[0-9]*.json 2>/dev/null | grep -v 'api_' | tail -3 || echo "  (none)"
    echo ""
    echo "Reports:"
    ls -lh data/*_report.txt 2>/dev/null | tail -3 || echo "  (none)"
